<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PMI â€“ Temporizador de Debate RelÃ¢mpago</title>
  <style>
    :root { --red: #B22234; }
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      background-color: #0b2550;
      background-image: url('logo.png');
      background-repeat: no-repeat;
      background-size: 308px auto;
      background-position: calc(100% - 24px) 20px;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      color: #fff;
      transition: background-color 1s;
    }
    body.finished { background-color: #052e16; }

    /* Sidebar */
    #sidebar {
      position: fixed;
      top: 50%;
      left: 53px;
      transform: translateY(-50%);
      width: 242px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
    .phase-row {
      padding: 8px 12px; border-radius: 6px;
      border-left: 3px solid transparent;
      transition: all 0.3s;
    }
    .phase-row.current {
      background: rgba(255,255,255,0.1);
      border-left-color: #fff;
    }
    .phase-row .pl { font-size: 17px; font-weight: 400; color: #4a6090; line-height: 1.3; }
    .phase-row.current .pl { font-weight: 700; color: #fff; }
    .phase-row .pt { font-size: 14px; color: #334d7a; margin-top: 2px; }
    .phase-row.current .pt { color: #cbd5e1; }

    /* Wrapper central */
    #main {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Coluna de conteÃºdo com largura fixa */
    #debate-view {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 572px;
    }

    #phase-label {
      width: 100%;
      text-align: center;
      font-size: 48px; font-weight: 800; color: #fff;
      margin-bottom: 4px;
    }
    #phase-team {
      width: 100%;
      text-align: center;
      font-size: 31px; color: #cbd5e1;
      margin-bottom: 35px;
    }

    /* Anel */
    #ring-wrap {
      position: relative;
      width: 374px; height: 374px;
      margin: 0 auto 44px;
    }
    #ring-svg { transform: rotate(-90deg); }
    #ring-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 15; }
    #ring-fg { fill: none; stroke: #fff; stroke-width: 15; stroke-linecap: round;
               transition: stroke-dashoffset 0.8s linear, stroke 0.3s; }
    #ring-fg.done { stroke: var(--red); }
    #timer-text {
      position: absolute; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }
    #timer-digits {
      font-size: 106px; font-weight: 800; color: #fff;
      font-variant-numeric: tabular-nums; line-height: 1;
    }
    #timer-digits.done { color: var(--red); }
    #timer-label {
      font-size: 12px; color: var(--red);
      margin-top: 9px; letter-spacing: 0.12em; display: none;
    }

    /* InterpelaÃ§Ã£o */
    #interp-wrap {
      width: 374px; height: 374px;
      margin: 0 auto 44px;
      background: rgba(255,255,255,0.05); border-radius: 50%;
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
      border: 4px solid var(--red);
    }
    #interp-wrap.response { border-color: #10b981; box-shadow: 0 0 44px #10b98133; }
    #interp-wrap.group    { box-shadow: 0 0 44px #B2223433; }
    #interp-tag   { font-size: 12px; letter-spacing: 0.12em; text-transform: uppercase; color: #94a3b8; margin-bottom: 7px; }
    #interp-who   { font-size: 17px; font-weight: 600; color: var(--red); margin-bottom: 9px; }
    #interp-wrap.response #interp-who { color: #10b981; }
    #interp-digits { font-size: 70px; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; }
    #btn-skip {
      margin-top: 15px; padding: 7px 15px;
      background: transparent; border: 1px solid #475569;
      border-radius: 6px; color: #94a3b8; font-size: 13px; cursor: pointer;
    }

    /* BotÃµes */
    .btn-row {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 22px;
      min-height: 62px;
    }
    #btn-start {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .btn-row2 {
      display: flex; gap: 13px;
      flex-wrap: wrap; justify-content: center;
    }
    button.ctrl {
      padding: 15px 26px; border-radius: 12px;
      font-size: 17px; font-weight: 700; cursor: pointer;
      min-width: 165px; border: 1px solid rgba(255,255,255,0.15);
      transition: all 0.15s; color: #f1f5f9;
    }
    button.ctrl:disabled {
      background: transparent; border-color: #1e3a6e;
      color: #1e3a6e; cursor: not-allowed;
    }
    #btn-prev, #btn-next, #btn-reset { background: #1e3a6e; }
    #btn-start { background: #fff; color: #0b2550; }
    #btn-start.running { background: #334155; color: #fff; }
    #btn-interp { background: var(--red); color: #fff; }
    #no-interp { font-size: 12px; color: #2d4a7a; padding: 10px 0; }

    /* EcrÃ£ final */
    #finished-screen {
      display: none; flex-direction: column;
      align-items: center; text-align: center;
    }
    #finished-screen.visible { display: flex; }
    #fin-emoji  { font-size: 66px; margin-bottom: 13px; }
    #fin-title  { font-size: 31px; font-weight: 800; color: #4ade80; margin-bottom: 9px; }
    #fin-sub    { font-size: 15px; color: #86efac; margin-bottom: 44px; }
    #fin-btns   { display: flex; gap: 13px; justify-content: center; }
    #btn-applause { background: #14532d; color: #4ade80; }
    #btn-restart  { background: #1e3a6e; }

    /* RodapÃ© */
    #footer {
      position: fixed; bottom: 18px; right: 22px;
      font-size: 12px; color: rgba(255,255,255,0.4);
      letter-spacing: 0.04em; line-height: 1.7;
      user-select: none;
      text-align: right;
    }
  </style>
</head>
<body>

  <div id="footer">
    Projecto Multidisciplinar I<br />
    <span id="clock"></span>
  </div>

  <div id="sidebar"></div>

  <div id="main">
    <div id="debate-view">
      <div id="phase-label"></div>
      <div id="phase-team"></div>

      <div id="ring-wrap">
        <svg id="ring-svg" width="374" height="374">
          <circle id="ring-bg" cx="187" cy="187" r="160" />
          <circle id="ring-fg" cx="187" cy="187" r="160" />
        </svg>
        <div id="timer-text">
          <div id="timer-digits"></div>
          <div id="timer-label">TEMPO ESGOTADO</div>
        </div>
      </div>

      <div id="interp-wrap">
        <div id="interp-tag">InterpelaÃ§Ã£o</div>
        <div id="interp-who"></div>
        <div id="interp-digits"></div>
        <button id="btn-skip" onclick="skipInterp()"></button>
      </div>

      <div class="btn-row">
        <button id="btn-prev"  class="ctrl" onclick="goPrev()">â† Fase anterior</button>
        <button id="btn-start" class="ctrl" onclick="toggleRun()">â–¶  Iniciar</button>
        <button id="btn-next"  class="ctrl" onclick="goNext()">Fase seguinte â†’</button>
      </div>
      <div class="btn-row2">
        <button id="btn-interp" class="ctrl" onclick="startInterp()">âœ‹ InterpelaÃ§Ã£o (1 + 1 min)</button>
        <div id="no-interp">InterpelaÃ§Ãµes nÃ£o permitidas nesta fase</div>
        <button id="btn-reset" class="ctrl" onclick="resetDebate()">â†º Reiniciar debate</button>
      </div>
    </div>

    <div id="finished-screen">
      <div id="fin-emoji">ğŸ‰</div>
      <div id="fin-title">Debate concluÃ­do!</div>
      <div id="fin-sub">Bom trabalho a todos os grupos.</div>
      <div id="fin-btns">
        <button id="btn-applause" class="ctrl" onclick="playApplause()">ğŸ‘ Palmas</button>
        <button id="btn-restart"  class="ctrl" onclick="resetDebate()">â†º Reiniciar</button>
      </div>
    </div>
  </div>
// â”€â”€ Suporte a apontador de apresentaÃ§Ã£o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Teclas enviadas pela maioria dos clickers (Logitech, Kensington, Interlink):
//   AvanÃ§ar : PageDown | ArrowRight | Period      â†’ avanÃ§a fase OU inicia/pausa
//   Recuar  : PageUp   | ArrowLeft  | Escape(*)   â†’ recua fase
//   (*) Escape sÃ³ recua; nÃ£o fecha nada, pois nÃ£o hÃ¡ diÃ¡logos modais.
//
// LÃ³gica adoptada:
//   - Se o debate ainda nÃ£o comeÃ§ou (timeLeft == duraÃ§Ã£o total e !running):
//       PageDown/Right â†’ toggleRun()   (inicia)
//   - Se em curso (!done):
//       PageDown/Right â†’ toggleRun()   (pausa/retoma)
//   - Se fase concluÃ­da (done):
//       PageDown/Right â†’ goNext()      (avanÃ§a fase)
//   - PageUp/Left â†’ goPrev() sempre (comportamento idÃªntico ao botÃ£o)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.addEventListener("keydown", function (e) {
  // Ignora se o foco estiver num campo de texto (seguranÃ§a extra)
  if (["INPUT", "TEXTAREA", "SELECT"].includes(document.activeElement.tagName)) return;

  const ADVANCE = ["PageDown", "ArrowRight", "Period", " ", "Enter"];
  const BACK    = ["PageUp",   "ArrowLeft",  "Escape", "Backspace"];

  if (ADVANCE.includes(e.key)) {
    e.preventDefault();
    if (finished) { playApplause(); return; }
    if (interp)   { skipInterp();   return; }   // avanÃ§a dentro da interpelaÃ§Ã£o
    if (done)     { goNext();       return; }   // fase terminada â†’ prÃ³xima fase
    toggleRun();                                 // inicia ou pausa
    return;
  }

  if (BACK.includes(e.key)) {
    e.preventDefault();
    if (e.key === "Escape" && !finished) { goPrev(); }
    else if (e.key !== "Escape")          { goPrev(); }
    return;
  }

  // InterpelaÃ§Ã£o: I ou F5
  // SÃ³ actua se o botÃ£o estiver visÃ­vel (fase permite interpelaÃ§Ã£o, nenhuma em curso)
  if (e.key === "i" || e.key === "I" || e.key === "F5") {
    e.preventDefault();
    const btn = document.getElementById("btn-interp");
    if (btn && btn.style.display !== "none") { startInterp(); }
    return;
  }
});

<script>
const PHASES = [
  { label:"ApresentaÃ§Ã£o",  team:"Defesa",   duration:120 },
  { label:"ApresentaÃ§Ã£o",  team:"OposiÃ§Ã£o",  duration:120 },
  { label:"ConferÃªncia 1", team:"Ambas",    duration:60  },
  { label:"RefutaÃ§Ã£o 1",   team:"Defesa",   duration:120 },
  { label:"RefutaÃ§Ã£o 1",   team:"OposiÃ§Ã£o", duration:120 },
  { label:"ConferÃªncia 2", team:"Ambas",    duration:60  },
  { label:"RefutaÃ§Ã£o 2",   team:"Defesa",   duration:60  },
  { label:"RefutaÃ§Ã£o 2",   team:"OposiÃ§Ã£o", duration:60  },
  { label:"ConferÃªncia 3", team:"Ambas",    duration:60  },
  { label:"ConclusÃ£o",     team:"Defesa",   duration:60  },
  { label:"ConclusÃ£o",     team:"OposiÃ§Ã£o", duration:60  },
];
const CIRC = 2 * Math.PI * 160;
const APARTE_DUR = 60;
const NO_INTERP = ["ApresentaÃ§Ã£o","ConclusÃ£o"];

let phaseIdx   = 0;
let timeLeft   = PHASES[0].duration;
let running    = false;
let done       = false;
let finished   = false;
let interp     = null;
let interpTime = APARTE_DUR;
let mainTimer  = null;
let interpTimer= null;

function playSound(f) { try { new Audio(f).play().catch(()=>{}); } catch(e){} }
function playBell()     { playSound("boxing bell.wav"); }
function playBuzzer()   { playSound("meditation gong.wav"); }
function playApplause() { playSound("applause.wav"); }

function fmt(s) {
  const m = Math.floor(Math.abs(s)/60), sec = Math.abs(s)%60;
  return (m<10?"0":"")+m+":"+(sec<10?"0":"")+sec;
}
function fmtClock(d) {
  const p = n => String(n).padStart(2,"0");
  return d.getFullYear()+"-"+p(d.getMonth()+1)+"-"+p(d.getDate())
    +" "+p(d.getHours())+":"+p(d.getMinutes())+":"+p(d.getSeconds());
}

setInterval(()=>{ document.getElementById("clock").textContent = fmtClock(new Date()); }, 1000);
document.getElementById("clock").textContent = fmtClock(new Date());

function buildSidebar() {
  const sb = document.getElementById("sidebar"); sb.innerHTML = "";
  PHASES.forEach((p,i) => {
    const d = document.createElement("div");
    d.className = "phase-row"+(i===phaseIdx?" current":"");
    d.innerHTML = `<div class="pl">${p.label}</div><div class="pt">${p.team} Â· ${fmt(p.duration)}</div>`;
    sb.appendChild(d);
  });
}

function updateRing() {
  const ph = PHASES[phaseIdx];
  const fg = document.getElementById("ring-fg");
  fg.setAttribute("stroke-dasharray", CIRC);
  fg.setAttribute("stroke-dashoffset", CIRC * (timeLeft/ph.duration));
  fg.className.baseVal = done ? "done" : "";
  document.getElementById("timer-digits").textContent = fmt(timeLeft);
  document.getElementById("timer-digits").className = done ? "done" : "";
  document.getElementById("timer-label").style.display = done ? "block" : "none";
}

function updateInterpDisplay() {
  const iw = document.getElementById("interp-wrap");
  const rw = document.getElementById("ring-wrap");
  if (interp) {
    iw.style.display = "flex"; rw.style.display = "none";
    iw.className = interp==="group" ? "group" : "response";
    document.getElementById("interp-who").textContent =
      interp==="group" ? "Grupo interpelante fala" : "Equipa responde";
    document.getElementById("interp-digits").textContent = fmt(interpTime);
    document.getElementById("btn-skip").textContent =
      "Saltar â†’ "+(interp==="group" ? "resposta" : "retomar");
  } else {
    iw.style.display = "none"; rw.style.display = "block";
  }
}

function updateButtons() {
  const ph = PHASES[phaseIdx];
  const noI = NO_INTERP.includes(ph.label) || ph.team==="Ambas";
  document.getElementById("btn-prev").style.visibility = phaseIdx===0 ? "hidden" : "visible";
  document.getElementById("btn-prev").disabled = phaseIdx===0;
  document.getElementById("btn-start").disabled = !!interp;
  const lbl = running ? "â¸  Pausar" : (timeLeft<PHASES[phaseIdx].duration ? "â–¶  Retomar" : "â–¶  Iniciar");
  document.getElementById("btn-start").textContent = lbl;
  document.getElementById("btn-start").className = "ctrl"+(running?" running":"");
  document.getElementById("btn-interp").style.display = (!noI&&!interp) ? "inline-block" : "none";
  document.getElementById("no-interp").style.display  = noI ? "block" : "none";
}

function render() {
  if (finished) {
    document.getElementById("debate-view").style.display = "none";
    document.getElementById("finished-screen").classList.add("visible");
    document.body.classList.add("finished"); return;
  }
  document.getElementById("debate-view").style.display = "flex";
  const ph = PHASES[phaseIdx];
  document.getElementById("phase-label").textContent = ph.label;
  document.getElementById("phase-team").textContent  = ph.team;
  buildSidebar(); updateRing(); updateInterpDisplay(); updateButtons();
}

function startMainTicker() {
  clearInterval(mainTimer);
  mainTimer = setInterval(() => {
    if (!running || interp) return;
    timeLeft--;
    if (timeLeft <= 0) {
      timeLeft=0; clearInterval(mainTimer); running=false; done=true;
      playBuzzer();
      if (phaseIdx===PHASES.length-1) { finished=true; playApplause(); }
      render();
    } else { updateRing(); }
  }, 1000);
}

function startInterpTicker() {
  clearInterval(interpTimer);
  interpTimer = setInterval(() => {
    interpTime--;
    if (interpTime <= 0) {
      interpTime=0; clearInterval(interpTimer);
      if (interp==="group") {
        interp="response"; interpTime=APARTE_DUR; playBell();
        updateInterpDisplay(); startInterpTicker();
      } else {
        interp=null;
        if (timeLeft>0) { running=true; startMainTicker(); }
        render();
      }
    } else { document.getElementById("interp-digits").textContent = fmt(interpTime); }
  },1000);
}

function toggleRun() {
  if (done && phaseIdx<PHASES.length-1) return;
  if (!running) playBell();
  running=!running;
  if (running) startMainTicker(); else clearInterval(mainTimer);
  updateButtons();
}

function goNext() {
  if (finished) { playApplause(); return; }
  clearInterval(mainTimer);
  if (phaseIdx>=PHASES.length-1) { finished=true; playApplause(); render(); return; }
  phaseIdx++; timeLeft=PHASES[phaseIdx].duration;
  running=false; done=false; interp=null;
  playBuzzer(); render();
}

function goPrev() {
  if (phaseIdx===0) return;
  clearInterval(mainTimer);
  phaseIdx--; timeLeft=PHASES[phaseIdx].duration;
  running=false; done=false; interp=null; render();
}

function startInterp() {
  clearInterval(mainTimer); running=false;
  interp="group"; interpTime=APARTE_DUR;
  render(); startInterpTicker();
}

function skipInterp() {
  clearInterval(interpTimer);
  if (interp==="group") {
    interp="response"; interpTime=APARTE_DUR; playBell();
    updateInterpDisplay(); startInterpTicker();
  } else {
    interp=null;
    if (timeLeft>0) { running=true; startMainTicker(); }
    render();
  }
}

function resetDebate() {
  clearInterval(mainTimer); clearInterval(interpTimer);
  phaseIdx=0; timeLeft=PHASES[0].duration;
  running=false; done=false; finished=false; interp=null;
  document.body.classList.remove("finished");
  document.getElementById("finished-screen").classList.remove("visible");
  render();
}

render();
</script>
</body>
</html>
